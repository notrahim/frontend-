{"ast":null,"code":"import _objectSpread from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _asyncToGenerator from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createForOfIteratorHelper from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _defineProperty from \"C:/Users/Techdotpk/Desktop/app/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.object.values.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/web.timers.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport axios from \"axios\";\nexport default {\n  props: [\"show\", \"form\", \"nameTask\", \"documents\", \"additionalFields\", \"selectedItem\", \"fonds\", \"autorisation\"],\n  components: {\n    FormalityPopUpList: function FormalityPopUpList() {\n      return import(\"@/components/popup/FormalityPopUpList.vue\");\n    }\n  },\n  data: function data() {\n    var _ref;\n\n    return _ref = {\n      tab: \"tab-1\",\n      readonly: true,\n      dialog: true,\n      selected: [],\n      dialog2: false,\n      file: \"\",\n      files: [],\n      documentsList: {},\n      addDocList: {},\n      type: \"\"\n    }, _defineProperty(_ref, \"dialog\", false), _defineProperty(_ref, \"result\", null), _defineProperty(_ref, \"doc\", \"\"), _defineProperty(_ref, \"docFormData\", {}), _defineProperty(_ref, \"storeFileNameWithKeys\", {}), _defineProperty(_ref, \"userData\", {\n      UserDenom: '',\n      UserTel: '',\n      UserZip: '',\n      UserRue: '',\n      UserVille: ''\n    }), _ref;\n  },\n  mounted: function mounted() {\n    this.fetchData();\n    this.documentsList = this.documents.reduce(function (acc, curr) {\n      acc[curr] = \"\";\n      return acc;\n    }, {});\n\n    var _iterator = _createForOfIteratorHelper(this.additionalFields),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var key = _step.value;\n\n        var _iterator2 = _createForOfIteratorHelper(Object.values(key)[0]),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var val = _step2.value;\n            console.log(\"line 106\", key, Object.keys(key)[0] + \"_\" + val);\n            this.addDocList[Object.keys(key)[0] + \"_\" + val] = \"\";\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  },\n  watch: {\n    dialog: function dialog(val) {\n      var _this = this;\n\n      if (!val) return;\n      setTimeout(function () {\n        return _this.dialog = false, _this.dialog2 = true;\n      }, 2000);\n    }\n  },\n  methods: {\n    fetchData: function fetchData() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var headers, _response;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                headers = {\n                  authorization: \"Bearer \" + _this2.$store.state.auth.user.token\n                };\n                _context.next = 4;\n                return axios.get(\"fiche\", {\n                  headers: headers\n                });\n\n              case 4:\n                _response = _context.sent;\n                _response = _toConsumableArray(_response.data)[0];\n                _this2.userData.UserDenom = _response.denomination;\n                _this2.userData.UserTel = _response.phone;\n                _this2.userData.UserZip = _response.postal;\n                _this2.userData.UserRue = _response.street;\n                _this2.userData.UserVille = _response.city;\n                _context.next = 16;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](0);\n                console.log(_context.t0);\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 13]]);\n      }))();\n    },\n    changeTab: function changeTab() {\n      this.tab = \"tab-2\";\n    },\n    handleFileImport: function handleFileImport(doc, type) {\n      this.doc = doc;\n      this.type = type;\n      this.$refs.uploader.click();\n    },\n    onFileChanged: function onFileChanged(event) {\n      console.log(event.target.files);\n\n      if (this.type == \"required\") {\n        this.documentsList[this.doc] = event.target.files[0]['name'];\n      }\n\n      if (this.type == \"additional\") {\n        this.addDocList[this.doc] = event.target.files[0]['name'];\n        this.$forceUpdate();\n      }\n\n      this.docFormData = _objectSpread(_objectSpread({}, this.docFormData), {}, _defineProperty({}, this.doc, event.target.files[0]));\n      this.storeFileNameWithKeys[event.target.files[0]['name']] = this.doc;\n    },\n    submitFiles: function submitFiles() {\n      var _this3 = this;\n\n      var formData = new FormData();\n      Object.values(this.docFormData).forEach(function (val) {\n        formData.append('files', val);\n      });\n      var requestData = {};\n      Object.keys(this.$refs.popupList.$refs).forEach(function (val) {\n        requestData = _objectSpread(_objectSpread({}, requestData), _this3.$refs.popupList.$refs[val][0]['postData']);\n      });\n\n      var form = _objectSpread(_objectSpread({}, requestData), this.userData); // formData.append('fileKeys', JSON.stringify({...this.storeFileNameWithKeys}))\n      // formData.append('name', this.nameTask)\n\n\n      formData.append('questions_form', JSON.stringify(form));\n      formData.append('form', 'M0-SC');\n      formData.append('userid', '123');\n      console.log(JSON.stringify(form)); // formData.append('form', this.form);\n      //   console.log(this.form)\n      //   console.log(JSON.stringify(form))\n      //   console.log(this.nameTask)\n      //  console.log('file names', JSON.stringify({...this.storeFileNameWithKeys}))\n\n      axios.post('http://localhost:8000/create_request', formData).then(function () {\n        (function (response) {\n          _this3.result = response.data;\n        });\n\n        console.log(response);\n      })[\"catch\"](function (err) {\n        [];\n        console.log(err);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;AA+IA;AACA;EACAA,6GADA;EAEAC;IACAC;MAAA;IAAA;EADA,CAFA;EAMAC,IANA,kBAMA;IAAA;;IACA;MACAC,YADA;MAEAC,cAFA;MAGAC,YAHA;MAIAC,YAJA;MAKAC,cALA;MAMAC,QANA;MAOAC,SAPA;MAQAC,iBARA;MASAC,cATA;MAUAC;IAVA,mCAWA,KAXA,mCAYA,IAZA,gCAaA,EAbA,wCAcA,EAdA,kDAeA,EAfA,qCAgBA;MACAC,aADA;MAEAC,WAFA;MAGAC,WAHA;MAIAC,WAJA;MAKAC;IALA,CAhBA;EAwBA,CA/BA;EAgCAC,OAhCA,qBAgCA;IACA;IACA;MACAC;MACA;IACA,CAHA,EAGA,EAHA;;IAFA,2CAMA,qBANA;IAAA;;IAAA;MAMA;QAAA;;QAAA,4CACAC,qBADA;QAAA;;QAAA;UACA;YAAA;YACAC;YACA;UACA;QAJA;UAAA;QAAA;UAAA;QAAA;MAKA;IAXA;MAAA;IAAA;MAAA;IAAA;EAYA,CA5CA;EA6CAC;IACAjB,MADA,kBACAkB,GADA,EACA;MAAA;;MACA;MAEAC;QAAA;MAAA;IACA;EALA,CA7CA;EAoDAC;IACAC,SADA,uBACA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAC,OAFA,GAEA;kBACAC;gBADA,CAFA;gBAAA;gBAAA,OAKAC;kBACAF;gBADA,EALA;;cAAA;gBAKAG,SALA;gBAQAA;gBACA;gBACA;gBACA;gBACA;gBACA;gBAbA;gBAAA;;cAAA;gBAAA;gBAAA;gBAeAT;;cAfA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAiBA,CAlBA;IAoBAU,SApBA,uBAoBA;MACA;IACA,CAtBA;IAuBAC,gBAvBA,4BAuBAC,GAvBA,EAuBArB,IAvBA,EAuBA;MACA;MACA;MACA;IACA,CA3BA;IA4BAsB,aA5BA,yBA4BAC,KA5BA,EA4BA;MACAd;;MACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA,mDACA,gBADA,2BAEA,QAFA,EAEAc,qBAFA;MAIA;IACA,CA1CA;IA4CAC,WA5CA,yBA4CA;MAAA;;MACA;MACAhB;QACAiB;MACA,CAFA;MAGA;MACAjB;QACAkB,8CACAA,WADA,GAEA,gDAFA;MAIA,CALA;;MAMA,2CACAA,WADA,GAEA,aAFA,EAZA,CAgBA;MACA;;;MACAD;MAGAA;MACAA;MAEAhB,kCAxBA,CAyBA;MAGA;MACA;MACA;MAEA;;MAEAQ,WACA,sCADA,EAEAQ,QAFA,EAIAE,IAJA,CAIA;QAAA;UACA;QACA,CAFA;;QAGAlB;MACA,CARA,WASA;QACA;QACAA;MACA,CAZA;IAaA;EA3FA;AApDA","names":["props","components","FormalityPopUpList","data","tab","readonly","dialog","selected","dialog2","file","files","documentsList","addDocList","type","UserDenom","UserTel","UserZip","UserRue","UserVille","mounted","acc","Object","console","watch","val","setTimeout","methods","fetchData","headers","authorization","axios","response","changeTab","handleFileImport","doc","onFileChanged","event","submitFiles","formData","requestData","then"],"sourceRoot":"src/components/popup","sources":["FormalityDocumentsList.vue"],"sourcesContent":["<template>\n  <div class=\"d-flex\">\n    <v-row align=\"center\">\n      <v-dialog :value=\"show\" persistent max-width=\"700\"\n      class=\"rounded-xl mt-5\"\n      width=\"500\"\n      color=\"white\"\n      :elevation=\"hover ? 0 : 12\"\n      :class=\"{ 'on-hover': hover }\">\n        <v-tabs v-model=\"tab\" color=\"accent\" slider-color=\"accent\">\n          <v-tab ripple href=\"#tab-1\">Questions</v-tab>\n          <v-tab ripple href=\"#tab-2\">Documents</v-tab>\n          <v-tab-item value=\"tab-1\">\n            <formality-pop-up-list\n              :selectedItem=\"selectedItem\"\n              ref=\"popupList\"\n            ></formality-pop-up-list>\n            <v-btn\n              class=\"ma-2\"\n              outlined\n              rounded\n              color=\"#f0a443\"\n              @click=\"changeTab()\">Documents\n            </v-btn>\n          </v-tab-item>\n          <v-tab-item value=\"tab-2\">\n            <v-card-text>\n              <v-card-text>\n                <div\n                  v-for=\"(document, index) in documents\"\n                  :key=\"index\"\n                  class=\"files-status-container\">\n                  <v-btn class=\"ma-2\" outlined rounded color=\"#f0a443\"\n                    @click=\"handleFileImport(document, 'required')\">\n                    <v-icon left> mdi-file </v-icon>\n                    {{ document }} </v-btn\n                  ><span class=\"status\">\n                    {{ documentsList[document] }}</span>\n                </div>\n                <input\n                  ref=\"uploader\"\n                  class=\"d-none\"\n                  type=\"file\"\n                  id=\"files\"\n                  accept=\"application/pdf\"\n                  @change=\"onFileChanged\"/>\n                <div v-if=\"fonds==true\">\n                  <div class=\"files-status-container\">\n                    <v-btn class=\"ma-2\" outlined rounded color=\"#f0a443\" @click=\"handleFileImport('fonds')\">\n                    <v-icon left>mdi-file</v-icon>Contrat de fonds</v-btn>\n                    <span class=\"status\">{{addDocList['fonds']}}</span>\n                  </div>\n                </div>\n                <div v-if=\"autorisation==true\">\n                  <div class=\"files-status-container\">\n                    <v-btn class=\"ma-2\" outlined rounded color=\"#f0a443\" @click=\"handleFileImport('autorisation')\">\n                    <v-icon left>mdi-file</v-icon>Autorisation d'activité</v-btn>\n                    <span class=\"status\">{{addDocList['autorisation']}}</span>\n                  </div>\n                </div>\n                <!-- <div v-for=\"(info, i) in additionalFields\" :key=\"'$' + i\">\n                  <div\n                    v-if=\"Object.keys(info).length\">\n                    <div\n                      v-for=\"(doc, doc_index) in Object.values(info)[0]\"\n                      :key=\"'$' + i + doc_index\"\n                      class=\"files-status-container\">\n                      <v-btn\n                        class=\"ma-2\"\n                        outlined\n                        rounded\n                        color=\"#f0a443\"\n                        @click=\"\n                          handleFileImport(\n                            Object.keys(info)[0] + '_' + doc,\n                            'additional')\">\n                        <v-icon left> mdi-file </v-icon>\n                        {{ doc }}\n                      </v-btn>\n                      <span class=\"status\">\n                        {{ addDocList[Object.keys(info)[0] + \"_\" + doc] }}\n                      </span>\n                    </div>\n                  </div>\n                </div> -->\n              </v-card-text>\n              <v-card-actions>\n                <v-spacer></v-spacer>\n                <div>\n                <v-btn color=\"darken-1\" \n                text \n                :disabled=\"dialog\"\n                :loading=\"dialog\"\n                @click=\"submitFiles();\n                dialog = true\"\n                >Envoyer\n                </v-btn>\n\n                <v-dialog\n                v-model=\"dialog\"\n                hide-overlay\n                persistent\n                width=\"300\">\n                <v-card\n                    color=\"accent\"\n                    dark>\n                    <v-card-text>\n                    En cours de traitement\n                    <v-progress-linear\n                        indeterminate\n                        color=\"white\"\n                        class=\"mb-0\"\n                    ></v-progress-linear>\n                    </v-card-text>\n                </v-card>\n                </v-dialog>\n\n                <v-dialog \n                max-width=\"500\" \n                transition=\"dialog-bottom-transition\" \n                persistent hide-overlay \n                v-model=\"dialog2\">\n                </v-dialog>\n\n              </div>\n                <v-btn\n                  color=\"darken-1\"\n                  text\n                  @click=\"selected = [];\n                  $emit('close');\n                  \">Fermer\n                </v-btn>\n              </v-card-actions>\n            </v-card-text>\n          </v-tab-item>\n        </v-tabs>\n      </v-dialog>\n    </v-row>\n  </div>\n</template>\n  \n\n<script>\nimport axios from \"axios\";\nexport default {\n  props: [\"show\", \"form\", \"nameTask\", \"documents\", \"additionalFields\", \"selectedItem\", \"fonds\", \"autorisation\"],\n  components: {\n    FormalityPopUpList: () => import(\"@/components/popup/FormalityPopUpList.vue\"),\n},\n\n  data() {\n    return {\n      tab: \"tab-1\",\n      readonly: true,\n      dialog: true,\n      selected: [],\n      dialog2: false,\n      file: \"\",\n      files: [],\n      documentsList: {},\n      addDocList: {},\n      type: \"\",\n      dialog: false,\n      result: null,\n      doc: \"\",\n      docFormData: {},\n      storeFileNameWithKeys: {},\n      userData: {\n        UserDenom : '',\n        UserTel : '',\n        UserZip : '',\n        UserRue : '',\n        UserVille : ''\n      }\n    };\n  },\n  mounted() {\n    this.fetchData()\n    this.documentsList = this.documents.reduce(function (acc, curr) {\n      acc[curr] = \"\";\n      return acc;\n    }, {});\n    for (let key of this.additionalFields) {\n      for (let val of Object.values(key)[0]) {\n        console.log(\"line 106\", key, Object.keys(key)[0] + \"_\" + val);\n        this.addDocList[Object.keys(key)[0] + \"_\" + val] = \"\";\n      }\n    }\n  },\n  watch: {\n          dialog (val) {\n            if (!val) return\n    \n            setTimeout(() => (this.dialog = false, this.dialog2 = true), 2000)\n          },\n        },\n  methods: {\n    async fetchData() {\n      try {\n        const headers = {\n          authorization: \"Bearer \" + this.$store.state.auth.user.token,\n        };\n        let response = await axios.get(\"fiche\", {\n          headers,\n        });\n        response = [...response.data][0]\n        this.userData.UserDenom = response.denomination\n        this.userData.UserTel = response.phone\n        this.userData.UserZip = response.postal\n        this.userData.UserRue = response.street\n        this.userData.UserVille = response.city\n      } catch (err) {\n        console.log(err);\n      }\n    },\n\n    changeTab() {\n      this.tab = \"tab-2\";\n    },\n    handleFileImport(doc, type) {\n      this.doc = doc;\n      this.type = type;\n      this.$refs.uploader.click();\n    },\n    onFileChanged(event) {\n      console.log(event.target.files)\n      if (this.type == \"required\") {\n        this.documentsList[this.doc] = event.target.files[0]['name'];\n      }\n      if (this.type == \"additional\") {\n        this.addDocList[this.doc] = event.target.files[0]['name'];\n        this.$forceUpdate();\n      }\n      this.docFormData = {\n        ...this.docFormData,\n        [this.doc]: event.target.files[0]\n      }\n      this.storeFileNameWithKeys[event.target.files[0]['name']] = this.doc;\n    },\n\n    submitFiles() {\n      const formData = new FormData();\n      Object.values(this.docFormData).forEach(val => {\n        formData.append('files', val);\n      })      \n      let requestData = {};\n      Object.keys(this.$refs.popupList.$refs).forEach(val=> {\n        requestData = {\n          ...requestData,\n          ...this.$refs.popupList.$refs[val][0]['postData']\n        }\n      })\n      let form = {\n        ...requestData,\n        ...this.userData\n      }\n      // formData.append('fileKeys', JSON.stringify({...this.storeFileNameWithKeys}))\n      // formData.append('name', this.nameTask)\n      formData.append('questions_form', JSON.stringify(form));\n\n\n      formData.append('form', 'M0-SC')\n      formData.append('userid', '123')\n\n      console.log(JSON.stringify(form))\n      // formData.append('form', this.form);\n\n      \n    //   console.log(this.form)\n    //   console.log(JSON.stringify(form))\n    //   console.log(this.nameTask)\n\n    //  console.log('file names', JSON.stringify({...this.storeFileNameWithKeys}))\n\n      axios.post(\n          'http://localhost:8000/create_request',\n          formData,\n        )\n        .then(() => {response => {\n          this.result = response.data\n        }\n          console.log(response);\n        })\n        .catch((err) => {\n          [];\n          console.log(err);\n        });\n    },\n  },\n};\n</script>\n\n<style>\n.v-tabs {\n  align-items: center;\n}\n.test {\n  padding: 10px;\n  margin-left: 10px;\n}\n</style>\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}